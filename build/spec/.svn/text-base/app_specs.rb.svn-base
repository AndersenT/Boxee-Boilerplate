require 'rspec'
require './lib/app'
require './lib/convention_app_descriptor'

describe App, "describing the app for the different environments" do
  
  describe "loading 3rd party repository descriptor" do
    describe "descriptor is explicity defined in a file" do
      it "should load the defined environment file" do
      
        App.should_receive(:get_file).with(:beta).and_return('./spec/assets/descriptor.beta.xml')
        
        descriptor = App.get_description :beta
        descriptor['id'].should == "GreatBoxeeBeta.RakeTest"
      end
    end
    
    describe "descriptor is not defined in a file" do
      it "should describe the app by convention based on the descriptor.xml file" do
      
        App.should_receive(:get_file).with(:beta).and_return('./spec/I_am_not_here.xml')
        App.should_receive(:get_file).with(:default).and_return('./spec/assets/descriptor.xml')
        
        descriptor = App.get_description :beta
        descriptor.should be_an_instance_of ConventionAppDescriptor 
      end
    end
  end
  
end